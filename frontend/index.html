<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Product Importer</title>
  <style>
    body{font-family:Arial;margin:40px}
    .box{max-width:600px;margin:auto}
  </style>
</head>
<body>
  <div class="box">
    <h1>Upload CSV</h1>
    <input id="file" type="file" accept=".csv"/>
    <button id="upload">Upload</button>
    <div id="status"></div>
  </div>
<script>
document.getElementById("upload").onclick = async () => {
  const f = document.getElementById("file").files[0];
  if (!f) return alert("Pick a CSV");
  const fd = new FormData();
  fd.append("file", f);
  document.getElementById("status").innerText = "Uploading...";
  const res = await fetch("http://localhost:8000/import", { method: "POST", body: fd });
  const data = await res.json();
  document.getElementById("status").innerText = `Job ${data.job_id} created. Polling...`;
  const jobId = data.job_id;
  const poll = setInterval(async () => {
    const s = await fetch(`http://localhost:8000/status/${jobId}`).then(r => r.json());
    document.getElementById("status").innerText = JSON.stringify(s);
    if (s.status === "SUCCESS" || s.status === "FAILURE") clearInterval(poll);
  }, 2000);
}
</script>
</body>
</html>
